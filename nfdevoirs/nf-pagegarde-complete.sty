% ============================================================================
% nf-pagegarde-complete.sty - Page de garde complète pour nfdevoirs
% Page de garde détaillée pour DS, EVA, DM avec consignes et conseils
% ============================================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{nfdevoirs/nf-pagegarde-complete}[2025/10/06 Page garde complète nfdevoirs]

% ============================================================================
% PACKAGES REQUIS
% ============================================================================
\RequirePackage{tcolorbox}
\RequirePackage{etoolbox}
\RequirePackage{enumitem}
\RequirePackage{fontawesome5}

% ============================================================================
% PAGE DE GARDE COMPLÈTE
% ============================================================================
\newcommand{\nfpagegarde}{%
  \thispagestyle{empty}%

  % Bandeau en haut si demandé
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \nfbandeau
    \vspace{0.3cm}  % Réduit de 0.5cm à 0.3cm
  }{}

  % En-tête avec titre et infos (adaptatif selon bandeau)
  \begin{center}
    \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
      {\LARGE\bfseries\color{nfcolpartie}\@title}  % LARGE vs Huge
    }{%
      {\Huge\bfseries\color{nfcolpartie}\@title}
    }

    \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
      \vspace{0.2cm}  % Réduit
    }{%
      \vspace{0.3cm}
    }
    {\color{nfcolpartie}\rule{0.6\textwidth}{2pt}}
    \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
      \vspace{0.3cm}  % Réduit
    }{%
      \vspace{0.5cm}
    }

    \begin{minipage}{0.45\textwidth}
      {\large\textbf{Nom :} \@nfnom}
    \end{minipage}%
    \hfill
    \begin{minipage}{0.45\textwidth}
      \raggedleft
      \expandafter\ifstrempty\expandafter{\@nfclasse}{}{{\large\textbf{Classe :} \@nfclasse}}
    \end{minipage}
  \end{center}

  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \vspace{0.5cm}  % Réduit de 0.8cm
  }{%
    \vspace{0.8cm}
  }

  % Section Informations (Barème / Durée / Date)
  \begin{center}
    \expandafter\ifstrequal\expandafter{\@nfbareme}{false}{}{%
      \begin{minipage}[t]{0.3\textwidth}
        \centering
        \textbf{\color{nfcolpartie}\faTrophy\ Barème} \\[0.2cm]
        \textbf{\nftotalpts\ points}%
        \ifnum\nftotalbonus>0
          \ + \textbf{\nftotalbonus\ bonus}%
        \fi \\
        \ifnum\nftotalpts=20
        \else
          \textit{\small note convertie sur 20 points}
        \fi
      \end{minipage}%
      \hfill
    }
    \expandafter\ifstrempty\expandafter{\@nfduree}{}{%
      \begin{minipage}[t]{0.3\textwidth}
        \centering
        \textbf{\color{nfcolpartie}\faClock\ Durée} \\[0.2cm]
        \textbf{\@nfduree}
      \end{minipage}%
      \hfill
    }%
    \expandafter\ifstrempty\expandafter{\@nfdate}{}{%
      \begin{minipage}[t]{0.3\textwidth}
        \centering
        % Adaptation du label selon le type de devoir
        \expandafter\ifstrequal\expandafter{\@nftypedevoir}{DM}{%
          \textbf{\color{nfcolpartie}\faCalendar\ Remise} \\[0.2cm]
        }{%
          \textbf{\color{nfcolpartie}\faCalendar\ Date} \\[0.2cm]
        }%
        \textbf{\@nfdate}
      \end{minipage}%
    }
  \end{center}

  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \vspace{0.3cm}  % Réduit de 0.5cm
  }{%
    \vspace{0.5cm}
  }

  % Boîte pour la note (vide, à remplir à la main)
  % Définir la hauteur selon la position du bandeau
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \def\nfhauteurboite{35mm}  % Réduit de 45mm
  }{%
    \def\nfhauteurboite{45mm}
  }
  \begin{tcolorbox}[
    enhanced,
    colback=white,
    colframe=nfcolpartie,
    boxrule=1.5pt,
    arc=2pt,
    left=10pt,
    right=10pt,
    top=8pt,
    bottom=8pt,
    height=\nfhauteurboite,
  ]
    \textbf{\color{nfcolpartie}Note et observations :}
    \vspace{2.3cm}
  \end{tcolorbox}

  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \vspace{0.3cm}  % Réduit de 0.5cm
  }{%
    \vspace{0.5cm}
  }

  % Section Consignes (taille adaptative)
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    {\textbf{\color{nfcolpartie}Consignes pour l'épreuve}}  % Sans \large
  }{%
    {\large\textbf{\color{nfcolpartie}Consignes pour l'épreuve}}
  }
  \vspace{0.2cm}

  \begin{itemize}[leftmargin=*, itemsep=3pt]
    \item \faCalculator\ L'usage de la calculatrice est \textbf{%
      \expandafter\ifstrempty\expandafter{\@nfcalculatrice}{%
        strictement interdit%
      }{%
        \expandafter\ifstrequal\expandafter{\@nfcalculatrice}{true}{%
          autorisé en mode examen%
        }{%
          \expandafter\ifstrequal\expandafter{\@nfcalculatrice}{false}{%
            strictement interdit%
          }{%
            \@nfcalculatrice%
          }%
        }%
      }%
    }.
    \item \faBan\ Aucun document, support de cours ou formulaire n'est admis.
    \item \faUserCheck\ Cette évaluation est \textbf{strictement individuelle}. Toute communication est prohibée.
    \item \faListOl\ Tous les exercices doivent être traités. Vous pouvez choisir l'ordre, mais chaque exercice doit être terminé avant de passer au suivant.
    \item \faExclamationTriangle\ Un point sera retiré de la note finale pour chacun des manquements suivants :
    \begin{itemize}[itemsep=2pt]
      \item Rédaction de qualité insuffisante
      \item Terminologie ou notation mathématique inappropriées
      \item Non-respect des consignes d'exécution
    \end{itemize}
  \end{itemize}

  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \vspace{0.3cm}  % Réduit de 0.5cm
  }{%
    \vspace{0.5cm}
  }

  % Section Conseils (taille adaptative)
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    {\textbf{\color{nfcolpartie}Conseils pour réussir}}  % Sans \large
  }{%
    {\large\textbf{\color{nfcolpartie}Conseils pour réussir}}
  }
  \vspace{0.2cm}

  \begin{itemize}[leftmargin=*, itemsep=3pt]
    \item \textbf{Prenez connaissance de l'ensemble du sujet} avant de commencer pour comprendre la structure et identifier les compétences à mobiliser.

    \item \textbf{Lisez attentivement les énoncés} pour bien cerner les capacités testées%
    \expandafter\ifstrempty\expandafter{\@nfeasteregg}{.}{\ {\color{nfcolaccent}\textit{(un point bonus vous attend si vous écrivez « \@nfeasteregg » en haut de votre copie)}}.}

    \item \textbf{Gérez votre temps} : recherche sur brouillon, rédaction soignée, puis relecture.

    \item \textbf{Utilisez un brouillon.} L'utilisation d'un brouillon améliore significativement la qualité de la rédaction et la gestion du temps.
  \end{itemize}

  \vspace{0.3cm}

  \begin{center}
    \textit{La clarté de la présentation facilite l'évaluation de votre raisonnement.}
  \end{center}

  % Bandeau en bas si demandé (défaut)
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{bas}{%
    \vfill
    \nfbandeau
  }{%
    % Si c'est "haut", on ne met rien ici (déjà affiché en haut)
    \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{}{%
      % Si c'est "aucun", on ne met rien non plus
      \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{aucun}{}{%
        % Par défaut (si option invalide), on met en bas
        \vfill
        \nfbandeau
      }%
    }%
  }

  \newpage
}

\endinput