% ============================================================================
% nf-pagegarde.sty - Page de garde et citation finale pour nfdevoirs
% Contient la génération de la page de garde et la citation de fin
% ============================================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{nfdevoirs/nf-pagegarde}[2025/10/02 Page de garde nfdevoirs]

% ============================================================================
% PACKAGES REQUIS
% ============================================================================
\RequirePackage{tcolorbox}
\RequirePackage{etoolbox}
\RequirePackage{enumitem}
\RequirePackage{fontawesome5}

% ============================================================================
% BANDEAU ÉTABLISSEMENT (VERSION COMPACTE)
% ============================================================================
\newcommand{\nfbandeau}{%
  % Design en trois colonnes égales (33% chacune)
  \begin{center}
    \begin{minipage}[c]{0.33\textwidth}
      % GAUCHE : Logo + Établissement (justifié à gauche)
      \raggedright
      \expandafter\ifstrempty\expandafter{\@nflogo}{%
        % Pas de logo : établissement centré verticalement
        \expandafter\ifstrempty\expandafter{\@nfetablissement}{}{%
          \vspace{0.3cm}%
          {\textbf{\@nfetablissement}}%
        }%
      }{%
        % Avec logo : logo au-dessus, établissement en-dessous
        \includegraphics[height=1cm]{\@nflogo}%
        \expandafter\ifstrempty\expandafter{\@nfetablissement}{}{%
          \\[0.1cm]{\textbf{\@nfetablissement}}%
        }%
      }%
    \end{minipage}%
    \begin{minipage}[c]{0.33\textwidth}
      % CENTRE : Année scolaire (centré horizontalement et verticalement)
      \centering
      \expandafter\ifstrempty\expandafter{\@nfanscol}{}{%
        \vspace{0.3cm}%
        {\textbf{Année scolaire \nfformatanscol{\@nfanscol}}}%
      }%
    \end{minipage}%
    \begin{minipage}[c]{0.33\textwidth}
      % DROITE : Auteur + Matière (justifié à droite)
      \raggedleft
      \expandafter\ifstrempty\expandafter{\@nfauteur}{%
        % Pas d'auteur, seulement matière
        \expandafter\ifstrempty\expandafter{\@nfmatiere}{}{%
          \vspace{0.3cm}%
          {\@nfmatiere}%
        }%
      }{%
        % Avec auteur : auteur au-dessus, matière en-dessous
        \vspace{0.1cm}%
        {\@nfauteur}%
        \expandafter\ifstrempty\expandafter{\@nfmatiere}{}{%
          \\[0.1cm]{\@nfmatiere}%
        }%
      }%
    \end{minipage}
  \end{center}
}

% ============================================================================
% PAGE DE GARDE
% ============================================================================
\newcommand{\nfpagegarde}{%
  \thispagestyle{empty}%

  % Bandeau en haut si demandé
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{haut}{%
    \nfbandeau
    \vspace{0.5cm}
  }{}

  % En-tête avec titre et infos
  \begin{center}
    {\Huge\bfseries\color{nfcolpartie}\@title}

    \vspace{0.3cm}
    {\color{nfcolpartie}\rule{0.6\textwidth}{2pt}}
    \vspace{0.5cm}

    \begin{minipage}{0.45\textwidth}
      {\large\textbf{Nom :} \@nfnom}
    \end{minipage}%
    \hfill
    \begin{minipage}{0.45\textwidth}
      \raggedleft
      \expandafter\ifstrempty\expandafter{\@nfclasse}{}{{\large\textbf{Classe :} \@nfclasse}}
    \end{minipage}
  \end{center}

  \vspace{0.8cm}

  % Section Informations (Barème / Durée / Date)
  \begin{center}
    \begin{minipage}[t]{0.3\textwidth}
      \centering
      \textbf{\color{nfcolpartie}\faTrophy\ Barème} \\[0.2cm]
      \textbf{\nftotalpts\ points}%
      \ifnum\nftotalbonus>0
        \ + \textbf{\nftotalbonus\ bonus}%
      \fi \\
      \ifnum\nftotalpts=20
      \else
        \textit{\small note convertie sur 20 points}
      \fi
    \end{minipage}%
    \hfill
    \expandafter\ifstrempty\expandafter{\@nfduree}{}{%
      \begin{minipage}[t]{0.3\textwidth}
        \centering
        \textbf{\color{nfcolpartie}\faClock\ Durée} \\[0.2cm]
        \textbf{\@nfduree}
      \end{minipage}%
      \hfill
    }%
    \expandafter\ifstrempty\expandafter{\@nfdate}{}{%
      \begin{minipage}[t]{0.3\textwidth}
        \centering
        \textbf{\color{nfcolpartie}\faCalendar\ Date} \\[0.2cm]
        \textbf{\@nfdate}
      \end{minipage}%
    }
  \end{center}

  \vspace{0.5cm}

  % Boîte pour la note (vide, à remplir à la main)
  \begin{tcolorbox}[
    enhanced,
    colback=white,
    colframe=nfcolpartie,
    boxrule=1.5pt,
    arc=2pt,
    left=10pt,
    right=10pt,
    top=8pt,
    bottom=8pt,
    height=45mm,
  ]
    \textbf{\color{nfcolpartie}Note et observations :}
    \vspace{2.3cm}
  \end{tcolorbox}

  \vspace{0.5cm}

  % Section Consignes
  {\large\textbf{\color{nfcolpartie}Consignes pour l'épreuve}}
  \vspace{0.2cm}

  \begin{itemize}[leftmargin=*, itemsep=3pt]
    \item \faCalculator\ L'usage de la calculatrice est \textbf{%
      \expandafter\ifstrempty\expandafter{\@nfcalculatrice}{%
        strictement interdit%
      }{%
        \expandafter\ifstrequal\expandafter{\@nfcalculatrice}{true}{%
          autorisé en mode examen%
        }{%
          \expandafter\ifstrequal\expandafter{\@nfcalculatrice}{false}{%
            strictement interdit%
          }{%
            \@nfcalculatrice%
          }%
        }%
      }%
    }.
    \item \faBan\ Aucun document, support de cours ou formulaire n'est admis.
    \item \faUserCheck\ Cette évaluation est \textbf{strictement individuelle}. Toute communication est prohibée.
    \item \faListOl\ Tous les exercices doivent être traités. Vous pouvez choisir l'ordre, mais chaque exercice doit être terminé avant de passer au suivant.
    \item \faExclamationTriangle\ Un point sera retiré de la note finale pour chacun des manquements suivants :
    \begin{itemize}[itemsep=2pt]
      \item Rédaction de qualité insuffisante
      \item Terminologie ou notation mathématique inappropriées
      \item Non-respect des consignes d'exécution
    \end{itemize}
  \end{itemize}

  \vspace{0.5cm}

  % Section Conseils
  {\large\textbf{\color{nfcolpartie}Conseils pour réussir}}
  \vspace{0.2cm}

  \begin{itemize}[leftmargin=*, itemsep=3pt]
    \item \textbf{Prenez connaissance de l'ensemble du sujet} avant de commencer pour comprendre la structure et identifier les compétences à mobiliser.

    \item \textbf{Lisez attentivement les énoncés} pour bien cerner les capacités testées%
    \expandafter\ifstrempty\expandafter{\@nfeasteregg}{.}{\ {\color{nfcolaccent}\textit{(un point bonus vous attend si vous écrivez « \@nfeasteregg » en haut de votre copie)}}.}

    \item \textbf{Gérez votre temps} : recherche sur brouillon, rédaction soignée, puis relecture.

    \item \textbf{Utilisez un brouillon.} L'utilisation d'un brouillon améliore significativement la qualité de la rédaction et la gestion du temps.
  \end{itemize}

  \vspace{0.3cm}

  \begin{center}
    \textit{La clarté de la présentation facilite l'évaluation de votre raisonnement.}
  \end{center}

  % Bandeau en bas si demandé (défaut)
  \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{bas}{%
    \vfill
    \nfbandeau
  }{%
    % Si ce n'est ni haut ni bas, on ne met rien (aucun)
    \expandafter\ifstrequal\expandafter{\@nfbandeaupos}{aucun}{}{%
      % Par défaut (si option invalide), on met en bas
      \vfill
      \nfbandeau
    }%
  }

  \newpage
}

% ============================================================================
% CITATION FINALE
% ============================================================================
\newcommand{\nfcitationfin}{%
  \vfill
  \begin{center}
    \rule{0.5\textwidth}{0.4pt}

    \vspace{0.5cm}

    {\Large\textbf{Fin du devoir}}

    \vspace{1cm}

    \expandafter\ifstrempty\expandafter{\@nfcitation}{}{%
      \parbox{0.8\textwidth}{%
        \centering
        \textit{\@nfcitation}
      }%
    }
  \end{center}
}

\endinput